version: '3.8'

services:
  portfolio:
    # 构建配置
    build:
      context: .
      dockerfile: Dockerfile
    
    # 容器名称
    container_name: portfolio-website
    
    # 端口映射（完全独立的端口）
    ports:
      - "3001:3001"
    
    # 环境变量
    environment:
      NODE_ENV: production
      PORT: 3001
    
    # 重启策略
    restart: unless-stopped
    
    # 资源限制
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 512M
        reservations:
          cpus: '0.5'
          memory: 256M
    
    # 日志配置
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    
    # 健康检查
    healthcheck:
      test: ["CMD", "node", "-e", "require('http').get('http://localhost:3001', (r) => {if (r.statusCode !== 200) throw new Error(r.statusCode)})"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s

# 可选：使用 Nginx 反向代理
# 取消注释下面的内容以启用反向代理
# 
# services:
#   nginx:
#     image: nginx:alpine
#     container_name: portfolio-nginx
#     ports:
#       - "80:80"
#       - "443:443"
#     volumes:
#       - ./nginx.conf:/etc/nginx/nginx.conf:ro
#       - ./ssl:/etc/nginx/ssl:ro
#     depends_on:
#       - portfolio
#     restart: unless-stopped
#     networks:
#       - portfolio-network
#
#   portfolio:
#     # ... 其他配置 ...
#     networks:
#       - portfolio-network
#
# networks:
#   portfolio-network:
#     driver: bridge
